== Generator Overview

The generator is responsible for creating data during test execution. The processor continuously calls all registered generators in a loop until each generator returns a value. If a generator directly modifies the `testcaseData` object, it must still return a dummy value to indicate completion.

=== Generator Lifecycle

.Generator Lifecycle
image::images/data-generator/lifeCycle.svg[]

The diagram above illustrates the abstract lifecycle of a generator. When the processor starts up, it registers all generators in the service registry and calls each generator's `loadStore()` method to initialize persistent data. Even if a generator does not use persistent storage, this function is invoked.

Once initialization is complete, the processor begins executing test cases. Each test case is processed independently. For every test case, the processor iterates over all generators and calls their `generate()` method repeatedly until each generator returns a valid value. If a generator cannot produce data on the first call—perhaps due to missing dependencies—it should return `undefined`, and it will be called again later.

When a generator returns data from `generate()`, the processor subsequently calls its `createPostProcessTodos()` method. This method allows the generator to schedule additional post-processing tasks. All returned post-process todo objects are collected, sorted by their order value, and then processed by calling the corresponding `postProcess()` methods.

After processing all test cases, the processor calls `saveStore()` on each generator to persist any state changes.

=== InstanceId

The `instanceId` is a unique identifier generated by the processor for each test case instance. It ensures that if the generator is called multiple times with the same `instanceId`, it returns the same data. 

Example::
  
  Consider a scenario where a test case requires a password to be generated, but the password must be entered in two separate fields ("Password" and "Password repeat"). The generator is invoked twice with the same `instanceId` for this test case, ensuring that both fields receive identical data. More details on this concept can be found in the accompanying tutorial.

=== Post Processing

While post processing is an exceptional use case, it can be very useful. Post processing directly modifies the `testcaseData` object without returning any new data.

For the processor to invoke the `postProcess()` method, the generator must first return one or more post-process todo objects from the `createPostProcessTodos()` method.

.Post Process Todo Object
[source,js]
----
{
  instanceIdSuffix: undefined,   <1>
  order: 1000,                   <2>
  config: {},                    <3>
  generatorName: 'MyGenerator'   <4>
}
----

<1> The instanceId suffix is optional. If not provided, the current instanceId is used.  
<2> The order number determines the execution sequence of todos. Default is 1000; adjust this value to enforce the desired order.  
<3> The config object can pass additional parameters to the `postProcess` method.  
<4> The generatorName (mandatory) specifies which generator's postProcess function will handle the todo.

=== Generator Constructor

When creating a generator, several options are available to configure its behavior. The following table outlines the available options:

[cols="1,8",options="header"]
|===
|Key            |Description

|logger         |The logger instance that the generator should use.
|dataGeneratorRegistry|The data generator registry. Each generator is registered here, allowing them to reference one another.
|unique         |{true/false} (default: true). If true, the generator must produce unique values. The definition of uniqueness is determined by the generator.
|maxUniqueTries |{number} (default: 100). Maximum number of attempts to generate a unique value before throwing an error.
|varDir         |The directory used to persist generated data.
|useStore       |{true/false} (default: false). Indicates whether the generator should persist its state.
|===

.additional properties

The following properties are maintained by the generator:

[cols="1,8",options="header"]
|===
|Key          |Description

|uniqueSet    |A Set used to store values that must remain unique.
|instanceData |A Map where generated data is stored and associated with each instanceId.
|name         |The unique name under which the generator is registered. Note that multiple instances of the same generator class can be registered under different names.
|===
